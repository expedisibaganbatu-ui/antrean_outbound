<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Aplikasi Sortir Antrean Mobil Masuk</title>
    <style>
      :root {
        --primary: #2563eb;
        --bg-light: #f1f5f9;
        --card-bg: #ffffff;
        --text-dark: #1e293b;
        --text-gray: #64748b;
        --border: #e2e8f0;
      }

      body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background-color: var(--bg-light);
        color: var(--text-dark);
        padding: 20px;
        margin: 0;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        padding: 2rem;
        border-radius: 12px;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      }

      h1 { font-size: 1.5rem; margin-bottom: 1.5rem; color: var(--text-dark); }
      
      /* Input & Button Styles */
      .controls { margin-bottom: 2rem; display: flex; gap: 10px; align-items: center; }
      input[type="file"] { padding: 8px; border: 1px solid #ccc; border-radius: 6px; }
      button {
        background-color: var(--primary); color: white; border: none;
        padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: 600;
        transition: 0.2s;
      }
      button:hover { background-color: #1d4ed8; }

      /* --- STYLE UTAMA PERUBAHAN --- */

      /* Container per Tanggal */
      .date-section {
        margin-bottom: 2rem;
        border: 1px solid var(--border);
        border-radius: 8px;
        overflow: hidden;
        background: #fff;
      }

      .date-header {
        background: #334155;
        color: white;
        padding: 10px 15px;
        font-weight: bold;
        display: flex;
        justify-content: space-between;
      }

      /* Container per Tipe Shipping */
      .shipping-section {
        padding: 15px;
        border-bottom: 1px dashed var(--border);
      }
      .shipping-section:last-child { border-bottom: none; }

      .shipping-title {
        font-size: 1.1rem;
        color: var(--primary);
        font-weight: 700;
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      /* AREA HORIZONTAL (QUEUE) */
      .horizontal-queue {
        display: flex;
        flex-direction: row; /* Arah ke samping */
        flex-wrap: wrap;     /* Turun ke bawah jika penuh */
        gap: 12px;           /* Jarak antar kartu */
      }

      /* KARTU MOBIL */
      .car-card {
        background: white;
        border: 1px solid #cbd5e1;
        border-left: 4px solid var(--primary); /* Aksen warna di kiri */
        border-radius: 6px;
        padding: 10px;
        width: 130px; /* Lebar fix agar rapi */
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: flex-start;
        transition: transform 0.2s;
      }

      .car-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        border-color: var(--primary);
      }

      .nopol {
        font-size: 1.1rem;
        font-weight: 800;
        color: var(--text-dark);
        margin-bottom: 4px;
        letter-spacing: 0.5px;
      }

      .waktu-box {
        font-size: 0.85rem;
        color: var(--text-gray);
        background: #f1f5f9;
        padding: 2px 6px;
        border-radius: 4px;
        display: flex;
        align-items: center;
        gap: 4px;
        width: 100%;
        box-sizing: border-box;
      }
      
      .waktu-icon { font-size: 0.8em; }

      /* Utility */
      .message-box {
        padding: 1rem; background: #fee2e2; color: #dc2626;
        border-radius: 6px; margin-bottom: 1rem; display: none;
      }
      #currentDate { text-align: right; margin-bottom: 10px; font-weight: 600; color: var(--text-gray); }
    </style>
  </head>
  <body>
    <p id="currentDate"></p>

    <div class="container">
      <h1>Dashboard Antrean Masuk (Horizontal)</h1>
      
      <div class="controls">
        <input type="file" id="fileInput" accept=".csv, .xlsx" />
        <button id="processButton">Proses Data</button>
      </div>

      <div id="messageBox" class="message-box"></div>
      <div id="resultArea"></div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <script>
      let rawData = null;

      document.addEventListener("DOMContentLoaded", () => {
        // Tampilkan Tanggal Hari Ini
        const today = new Date();
        document.getElementById("currentDate").textContent = today.toLocaleDateString("id-ID", {
          weekday: "long", year: "numeric", month: "long", day: "numeric"
        });

        const fileInput = document.getElementById("fileInput");
        const processButton = document.getElementById("processButton");
        const resultArea = document.getElementById("resultArea");
        const messageBox = document.getElementById("messageBox");

        // 1. BACA FILE
        fileInput.addEventListener("change", (e) => {
          const file = e.target.files[0];
          if (!file) return;
          const reader = new FileReader();
          reader.onload = (e) => {
            const data = new Uint8Array(e.target.result);
            const workbook = XLSX.read(data, { type: "array" });
            const sheet = workbook.Sheets[workbook.SheetNames[0]];
            rawData = XLSX.utils.sheet_to_json(sheet);
            resultArea.innerHTML = '<p style="color:green">File dimuat. Klik tombol Proses.</p>';
          };
          reader.readAsArrayBuffer(file);
        });

        // 2. PROSES DATA
        processButton.addEventListener("click", () => {
          if (!rawData) {
            messageBox.style.display = "block";
            messageBox.textContent = "Pilih file dulu!";
            return;
          }
          messageBox.style.display = "none";

          // A. Bersihkan Data (Split Tanggal & Jam)
          const processed = rawData.map(row => {
            const rawConfirm = row["Confirm In"];
            let date = "-", time = "-";
            
            if (rawConfirm && typeof rawConfirm === 'string') {
              // Coba pisahkan Spasi (Excel format text) atau format ISO
              let parts = rawConfirm.trim().split(" ");
              if (parts.length > 1) {
                date = parts[0];
                time = parts.slice(1).join(" "); // Ambil sisa sebagai jam
              } else {
                 // Coba pisah -
                 parts = rawConfirm.split("-");
                 if(parts.length > 3) {
                    date = `${parts[0]}-${parts[1]}-${parts[2]}`;
                    time = parts.slice(3).join(":");
                 } else {
                    date = rawConfirm; 
                 }
              }
            }
            
            return {
              nopol: row["No. Polisi"] || "No Plate",
              tipe: row["Tipe Shipping"] || "Lainnya",
              tanggal: date,
              jam: time
            };
          });

          // B. Sorting (Tanggal -> Tipe -> Jam)
          processed.sort((a, b) => {
             if (a.tanggal !== b.tanggal) return a.tanggal.localeCompare(b.tanggal);
             if (a.tipe !== b.tipe) return a.tipe.localeCompare(b.tipe);
             return a.jam.localeCompare(b.jam);
          });

          // C. Rendering Tampilan
          renderHorizontalLayout(processed);
        });

        function renderHorizontalLayout(data) {
          resultArea.innerHTML = "";
          
          if (data.length === 0) {
            resultArea.innerHTML = "<p>Data kosong.</p>"; 
            return;
          }

          // Grouping Data
          const groups = {};
          data.forEach(item => {
            if (!groups[item.tanggal]) groups[item.tanggal] = {};
            if (!groups[item.tanggal][item.tipe]) groups[item.tanggal][item.tipe] = [];
            groups[item.tanggal][item.tipe].push(item);
          });

          // Loop Group Tanggal
          for (const [tgl, tipeGroups] of Object.entries(groups)) {
            const dateSection = document.createElement("div");
            dateSection.className = "date-section";

            // Header Tanggal
            dateSection.innerHTML = `<div class="date-header"><span>ðŸ“… ${tgl}</span></div>`;

            // Loop Tipe Shipping
            for (const [tipe, items] of Object.entries(tipeGroups)) {
               const shippingSection = document.createElement("div");
               shippingSection.className = "shipping-section";

               // Judul Tipe
               shippingSection.innerHTML = `<div class="shipping-title">ðŸšš ${tipe} <span style="font-size:0.8em; color:#64748b; font-weight:normal;">(${items.length} unit)</span></div>`;

               // Container Horizontal (Flex Row)
               const queueContainer = document.createElement("div");
               queueContainer.className = "horizontal-queue";

               // Loop Mobil (Buat Kartu)
               items.forEach(mobil => {
                 const card = document.createElement("div");
                 card.className = "car-card";
                 // HANYA NOPOL DAN JAM
                 card.innerHTML = `
                    <div class="nopol">${mobil.nopol}</div>
                    <div class="waktu-box">
                      <span class="waktu-icon">ðŸ•’</span> ${mobil.jam}
                    </div>
                 `;
                 queueContainer.appendChild(card);
               });

               shippingSection.appendChild(queueContainer);
               dateSection.appendChild(shippingSection);
            }

            resultArea.appendChild(dateSection);
          }
        }
      });
    </script>
  </body>
</html>
