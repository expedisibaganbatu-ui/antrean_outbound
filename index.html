<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Aplikasi Sortir Antrean Mobil Masuk</title>
    <style>
      /* Penggunaan properti khusus CSS untuk kemudahan pemeliharaan */
      :root {
        --color-primary: #7154b1;
        --color-primary-hover: #805dc1;
        --color-text-dark: #1e293b;
        --color-text-medium: #475569;
        --color-text-light: #334155;
        --color-bg-light: #f0f4f8;
        --color-bg-white: #ffffff;
        --color-border: #e2e8f0;
        --color-bg-hover: #f1f5f9;
        --color-bg-code: #e2e8f0;
        --color-error-bg: #fecaca;
        --color-error-text: #ef4444;
        --color-error-border: #fca5a5;
      }

      body {
        font-family: Arial, Helvetica, sans-serif;
        color: var(--color-text-light);
        padding: 2rem;
        position: relative;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }

      .container {
        max-width: 100%;
        margin: 0 auto;
        background-color: var(--color-bg-light);
        padding: 2rem;
        border-radius: 1rem;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }

      h1 {
        color: var(--color-text-dark);
        font-size: 1.5rem;
        margin-bottom: 1.5rem;
      }

      #fileInput {
        padding: 0.5rem;
        border: 1px solid #cbd5e1;
        border-radius: 0.5rem;
        background-color: #f8fafc;
        /* Menghilangkan gaya default input file */
        appearance: none;
      }

      #processButton {
        background-color: var(--color-primary);
        color: white;
        padding: 0.75rem 1.5rem;
        border: none;
        border-radius: 0.5rem;
        font-weight: bold;
        cursor: pointer;
        transition: background-color 0.2s ease-in-out;
        margin-left: 1rem;
      }

      #processButton:hover {
        background-color: var(--color-primary-hover);
      }

      #spreadsheet-data {
        margin-top: 2rem;
        overflow-x: auto;
        display: flex;
        flex-direction: column;
      }
      #spreadsheet-data > details > summary:first-child {
        background-color: #475569;
        color: var(--color-bg-light);
      }

      table {
        border-collapse: collapse;
        width: 100%;
        min-width: 800px;
        background-color: var(--color-bg-white);
        border-radius: 0.5rem;
        overflow: hidden;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        margin-bottom: 1rem;
      }

      th,
      td {
        border: 1px solid var(--color-border);
        padding: 1rem;
        text-align: left;
        white-space: nowrap;
      }

      th {
        background-color: var(--color-border);
        font-weight: 600;
        color: var(--color-text-medium);
      }

      tr:nth-child(even) {
        background-color: #f8fafc;
      }

      tr:hover {
        background-color: var(--color-bg-hover);
      }

      .message-box {
        margin-top: 1rem;
        padding: 1rem;
        background-color: var(--color-error-bg);
        color: var(--color-error-text);
        border: 1px solid var(--color-error-border);
        border-radius: 0.5rem;
        display: none;
      }

      details > summary {
        font-size: 1rem;
        margin: 0.5rem 0;
        padding: 1rem;
        background-color: var(--color-border);
        color: var(--color-text-medium);
        border-radius: 0.5rem;
        list-style: none;
        cursor: pointer;
        /* Atur list-style untuk konsistensi */
        display: flex;
        align-items: center;
      }

      details summary::-webkit-details-marker,
      details summary::marker {
        display: none;
      }

      details > summary:before {
        content: "â–¶ï¸";
        margin-right: 1rem;
        transition: transform 0.2s ease-in-out;
      }

      details[open] > summary:before {
        transform: rotate(90deg);
      }

      details {
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }

      summary strong {
        font-size: 1.4em;
      }

      .image-content {
        text-align: center;
        margin-top: 2rem;
      }

      img {
        max-width: 100%;
        height: auto;
      }

      #currentDate {
        font-size: 1.2rem;
        display: flex;
        justify-content: end;
        margin: 1rem;
      }

      li {
        line-height: 1.5rem;
      }

      code {
        background-color: var(--color-bg-code);
        padding: 0.2em 0.4em;
        border-radius: 0.3rem;
        font-family: Consolas, Monaco, "Andale Mono", "Ubuntu Mono", monospace;
        font-size: 0.9em;
      }
    </style>
  </head>
  <body>
    <p id="currentDate"></p>

    <div class="container">
      <h1>Aplikasi Sortir Antrean Mobil Masuk</h1>
      <input type="file" id="fileInput" accept=".csv, .xlsx" />
      <button id="processButton">Proses Data</button>

      <div id="messageBox" class="message-box"></div>

      <div id="spreadsheet-data"></div>

      <div
        style="
          background-color: var(--color-bg-hover);
          padding: 1rem;
          border-radius: 0.5rem;
          margin-top: 1rem;
        "
      >
        <p>
          <span style="font-weight: bold; color: var(--color-primary)"
            >Kelola Antrean Mobil Masuk Anda Lebih Efisien!</span
          >
          Aplikasi ini dirancang untuk membantu Anda dengan mudah memproses dan
          menyortir data antrean mobil masuk dari file spreadsheet (<code
            >.csv</code
          >
          atau <code>.xlsx</code>).
        </p>
        <p>
          <span style="font-weight: bold; color: var(--color-primary)"
            >Cara Menggunakan:</span
          >
        </p>
        <ol>
          <li>
            Klik tombol <code>Choose File</code> dan pilih file spreadsheet Anda
            (format CSV atau XLSX).
          </li>
          <li>
            Setelah file berhasil dimuat, klik tombol
            <code style="background-color: var(--color-primary); color: white"
              >Proses Data</code
            >.
          </li>
          <li>
            Aplikasi akan memproses dan menampilkan antrean dalam grup yang
            terorganisir berdasarkan Tanggal dan Tipe Shipping. Klik pada judul
            setiap grup untuk melihat atau menyembunyikan detail antrean di
            dalamnya.
          </li>
        </ol>
        <p>
          <span style="font-weight: bold; color: var(--color-primary)"
            >Fitur Unggulan:</span
          >
        </p>
        <ul>
          <li>
            <strong>Pemisahan Otomatis:</strong> Tanggal dan waktu dari kolom
            "Confirm In" langsung dipisahkan untuk kemudahan analisis.
          </li>
          <li>
            <strong>Pengurutan Cerdas:</strong> Data antrean diurutkan secara
            otomatis berdasarkan Tanggal, Tipe Shipping, dan Waktu Confirm In,
            memastikan prioritas yang jelas.
          </li>
          <li>
            <strong>Pengelompokan Intuitif:</strong> Antrean dikelompokkan
            berdasarkan Tipe Shipping dalam tampilan yang rapi dan dapat
            diciutkan (collapsible), memudahkan navigasi data.
          </li>
          <li>
            <strong>Tampilan Ringkas:</strong> Hanya menampilkan informasi kunci
            seperti No. Polisi, Driver, KM In/Out, dan Waktu Confirm In dalam
            tabel hasil.
          </li>
        </ul>
      </div>
    </div>

    <div
      style="
        margin-top: 1.5rem;
        border-top: 1px solid var(--color-border);
        padding-top: 1.5rem;
      "
    >
      <div class="image-content">
        <img src="transport art.avif" alt="transport logistic" />
      </div>

      <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
      <script>
        let rawData = null;

        document.addEventListener("DOMContentLoaded", () => {
          const currentDateElement = document.getElementById("currentDate");
          const today = new Date();
          const options = {
            weekday: "long",
            year: "numeric",
            month: "long",
            day: "numeric",
          };
          const formattedDate = today.toLocaleDateString("id-ID", options);
          currentDateElement.textContent = `${formattedDate}`;
          const messageBox = document.getElementById("messageBox");
          const fileInput = document.getElementById("fileInput");
          const processButton = document.getElementById("processButton");

          /**
           * Memuat file yang dipilih oleh pengguna.
           * Data diubah menjadi array of objects dan disimpan di variabel `rawData`.
           */
          fileInput.addEventListener("change", function (e) {
            const file = e.target.files[0];
            if (!file) {
              return;
            }

            const reader = new FileReader();
            reader.onload = function (e) {
              const data = new Uint8Array(e.target.result);
              const workbook = XLSX.read(data, {
                type: "array",
              });
              const sheetName = workbook.SheetNames[0];
              const sheet = workbook.Sheets[sheetName];

              rawData = XLSX.utils.sheet_to_json(sheet);

              hideMessage();
              document.getElementById("spreadsheet-data").innerHTML =
                '<p>File berhasil dimuat. Tekan "Proses Data" untuk melihat hasil.</p>';
            };
            reader.readAsArrayBuffer(file);
          });

          /**
           * Memproses data ketika tombol "Proses Data" diklik.
           * Melakukan pemisahan tanggal/waktu, pengurutan, dan menampilkan hasil.
           */
          processButton.addEventListener("click", function () {
            if (!rawData) {
              showMessage("Silakan pilih file terlebih dahulu.");
              return;
            }
            hideMessage();

            const processedData = rawData.map((row) => {
              const confirmInValue = row["Confirm In"];
              let date = "";
              let time = "";

              if (
                confirmInValue &&
                typeof confirmInValue === "string" &&
                confirmInValue.trim() !== ""
              ) {
                const parts = confirmInValue.split(" ");
                if (parts.length > 1) {
                  date = parts[0];
                  time = parts.slice(1).join(" ");
                } else {
                  // Coba pisahkan dengan "-" jika format default gagal
                  const dashParts = confirmInValue.split("-");
                  if (dashParts.length >= 4) {
                    date = `${dashParts[0]}-${dashParts[1]}-${dashParts[2]}`;
                    time = dashParts.slice(3).join(":");
                  } else {
                    date = confirmInValue;
                    time = "";
                  }
                }
              }

              const newRow = { ...row };
              newRow["Tanggal Confirm In"] = date;
              newRow["Waktu Confirm In"] = time;
              delete newRow["Confirm In"];

              return newRow;
            });

            processedData.sort((a, b) => {
              const dateA = a["Tanggal Confirm In"] || "";
              const dateB = b["Tanggal Confirm In"] || "";
              if (dateA !== dateB) {
                return dateA.localeCompare(dateB);
              }

              const shippingA = a["Tipe Shipping"] || "";
              const shippingB = b["Tipe Shipping"] || "";
              if (shippingA !== shippingB) {
                return shippingA.localeCompare(shippingB);
              }

              const timeA = a["Waktu Confirm In"] || "";
              const timeB = b["Waktu Confirm In"] || "";
              return timeA.localeCompare(timeB);
            });

            displayGroupedTable(processedData);
          });

          /**
           * Mengelompokkan dan menampilkan data dalam tabel yang dapat diciutkan.
           */
          function displayGroupedTable(data) {
            if (data.length === 0) {
              document.getElementById("spreadsheet-data").innerHTML =
                "<p>Data tidak ditemukan setelah diproses.</p>";
              return;
            }

            const tableContainer = document.getElementById("spreadsheet-data");
            tableContainer.innerHTML = "";

            const dateColumn = "Tanggal Confirm In";
            const shippingTypeColumn = "Tipe Shipping";

            const groupedByDate = {};
            data.forEach((row) => {
              const date = row[dateColumn] || "Proses Kiriman";
              if (!groupedByDate[date]) {
                groupedByDate[date] = [];
              }
              groupedByDate[date].push(row);
            });

            for (const date in groupedByDate) {
              const dateData = groupedByDate[date];
              const dateDetailsElement = document.createElement("details");
              const dateSummaryElement = document.createElement("summary");
              dateSummaryElement.innerHTML = `<strong>ðŸšš : ${date} &nbsp; </strong> (${dateData.length} item)`;
              dateDetailsElement.appendChild(dateSummaryElement);

              const groupedByShippingType = {};
              dateData.forEach((row) => {
                const shippingType =
                  row[shippingTypeColumn] || "Proses Kiriman";
                if (!groupedByShippingType[shippingType]) {
                  groupedByShippingType[shippingType] = [];
                }
                groupedByShippingType[shippingType].push(row);
              });

              for (const shippingType in groupedByShippingType) {
                const shippingData = groupedByShippingType[shippingType];
                const shippingDetailsElement =
                  document.createElement("details");
                const shippingSummaryElement =
                  document.createElement("summary");
                shippingSummaryElement.innerHTML = `<strong style="margin-left: 2rem;">${shippingType} &nbsp; </strong> (${shippingData.length} item)`;
                shippingDetailsElement.appendChild(shippingSummaryElement);

                const relevantHeaders = [
                  "No. Polisi",
                  "Driver",
                  "KM In",
                  "KM Out",
                  "Waktu Confirm In",
                ];

                const table = document.createElement("table");
                const thead = document.createElement("thead");
                const tbody = document.createElement("tbody");

                const headerRow = document.createElement("tr");
                relevantHeaders.forEach((headerText) => {
                  const th = document.createElement("th");
                  th.textContent = headerText;
                  headerRow.appendChild(th);
                });
                thead.appendChild(headerRow);
                table.appendChild(thead);

                shippingData.forEach((rowData) => {
                  const tr = document.createElement("tr");
                  relevantHeaders.forEach((headerText) => {
                    const td = document.createElement("td");
                    td.textContent = rowData[headerText] || "";
                    tr.appendChild(td);
                  });
                  tbody.appendChild(tr);
                });
                table.appendChild(tbody);

                shippingDetailsElement.appendChild(table);
                dateDetailsElement.appendChild(shippingDetailsElement);
              }

              tableContainer.appendChild(dateDetailsElement);
            }
          }

          /**
           * Menampilkan pesan error.
           */
          function showMessage(text) {
            messageBox.textContent = text;
            messageBox.style.display = "block";
          }

          /**
           * Menyembunyikan kotak pesan.
           */
          function hideMessage() {
            messageBox.style.display = "none";
          }
        });
      </script>
    </div>
  </body>
</html>
